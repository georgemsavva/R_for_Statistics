<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="George Savva, QIB">
<meta name="author" content="Pirita Paajanen, JIC">
<meta name="dcterms.date" content="2024-04-01">

<title>Intro to R for statistics, Day 2/3 â€“ R and Statistics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Statistics and R in Biology</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> <i class="bi bi-fa-home" role="img">
</i> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-intro-to-r-for-statistics" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Intro to R for Statistics</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-intro-to-r-for-statistics">    
        <li>
    <a class="dropdown-item" href="./day1.html">
 <span class="dropdown-text">NBI PhD Intro to R Day 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./day2.html">
 <span class="dropdown-text">NBI PhD Intro to R Day 2/3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./workshopscript.html">
 <span class="dropdown-text">JIC MSc Workshop (2021/2022)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./day3msc.html">
 <span class="dropdown-text">JIC MSc Plant Growth Example (2025)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./irisScript.html">
 <span class="dropdown-text">Iris data walkthough</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-how-many-samples-do-i-need" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">How many samples do I need?</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-how-many-samples-do-i-need">    
        <li class="dropdown-header">Course notes</li>
        <li>
    <a class="dropdown-item" href="./sampleSize.html">
 <span class="dropdown-text">How many samples do I need?</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-statistics-notes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Statistics notes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-statistics-notes">    
        <li>
    <a class="dropdown-item" href="./day3.html">
 <span class="dropdown-text">Notes on graphing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./dichot.html">
 <span class="dropdown-text">Do not group your data points</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./alphabeta.html">
 <span class="dropdown-text">Simple alpha and beta diversity simulation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./berkson.html">
 <span class="dropdown-text">Selection bias (Berkson bias) in observational studies</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./independentclusters.html">
 <span class="dropdown-text">Sampling from clustered data in observational studies</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./repeats.html">
 <span class="dropdown-text">Run bigger experiments instead of internal replications</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="mailto:george.savva@quadram.ac.uk"> <i class="bi bi-fa-envelope-o" role="img">
</i> 
<span class="menu-text">Contact me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/georgemsavva"> <i class="bi bi-fa-github" role="img">
</i> 
<span class="menu-text">GitHub</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#using-readxl-to-read-data-from-excel-files" id="toc-using-readxl-to-read-data-from-excel-files" class="nav-link active" data-scroll-target="#using-readxl-to-read-data-from-excel-files">Using <code>readxl</code> to read data from Excel files</a></li>
  <li><a href="#cleaning" id="toc-cleaning" class="nav-link" data-scroll-target="#cleaning">Cleaning</a></li>
  <li><a href="#analysis---exercises" id="toc-analysis---exercises" class="nav-link" data-scroll-target="#analysis---exercises">Analysis - Exercises</a></li>
  <li><a href="#solutions" id="toc-solutions" class="nav-link" data-scroll-target="#solutions">Solutions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Intro to R for statistics, Day 2/3</h1>
<p class="subtitle lead">Self-directed exercise</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>George Savva, QIB </p>
             <p>Pirita Paajanen, JIC </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 1, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Todayâ€™s worksheet introduces you to a real dataset.</p>
<p>The tasks you will cover are:</p>
<ul>
<li>Reading data into R from an Excel file</li>
<li>Checking and cleaning the data</li>
<li>Revision of some of statistics and graphing that we covered on the first day.</li>
<li>The importance of checking model validity</li>
</ul>
<p>You can attempt the worksheet by following the material on your own on day 2.</p>
<p>On day 3 we will run through the work discussing any issues related to R or statistics that arise.</p>
<div class="callout callout-style-default callout-important callout-titled" title="Note for day 2">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note for day 2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Expect to spend about three hours on todayâ€™s work in total. You all have different levels of knowledge and experience with data analysis and programming, and there is hopefully something in the exercises that will stretch everyone no matter what their background!</p>
<p>So make a good effort at the tutorial and the exercises, work together and use extra resources if needed (part of the skill is knowing where to go for help), but donâ€™t spend more than half a day on this unless you want to!</p>
</div>
</div>
<section id="the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="the-dataset">The dataset</h2>
<p>The data are from a randomised clinical trial of a new rehabilition intervention (compared to standard care) aimed at improving the walking speed of people recovering from stroke.</p>
<p>Better walking speed is a good indicator of general stroke recovery.</p>
<p>We have recorded:</p>
<ul>
<li>The age and sex of each participant,</li>
<li>The treatment allocation,</li>
<li>The hospital department from which they were recruited and</li>
<li>Time they take to complete a walking task after their treatment.</li>
</ul>
<p>Our research questions are:</p>
<ul>
<li>Does the new treatment improve walking speed compared to control treatment?</li>
<li>By how much does it improve, and how certain are we of this?</li>
</ul>
<p>The dataset can be found at <a href="./walkingspeed_day2.xlsx">walkingspeed_day2.xlsx</a></p>
<ul>
<li>Powerpoint slides to support this material are at:</li>
</ul>
<p><a href="./day3.pptx">Graphing - day3.pptx</a></p>
<p><a href="./day3_data_lm.pptx">day3_data_lm.pptx</a></p>
</section>
<section id="using-readxl-to-read-data-from-excel-files" class="level1">
<h1>Using <code>readxl</code> to read data from Excel files</h1>
<p>R is not used for data entry or storage; you are likely to have data stored as an Excel file, a csv file, in a database, or in some other format generated by a device.</p>
<p>So before we can do any analysis we need to import data. We do this in code like everything else in R.</p>
<p>Base R cannot read data from Excel files. But several add-on â€˜packagesâ€™ <em>can</em> read and write Excel files. Currently the best package for reading Excel files is called <code>readxl</code>. For writing Excel files the <code>openxlsx</code> package is very good.</p>
<p>Whatever the format your raw data there is likely to be a package to read it into R:</p>
<ul>
<li><code>readxl</code> for Excel format</li>
<li><code>haven</code> for other statistics packages (Stata, SPSS etc)</li>
<li><code>readr</code> or <code>data.table</code> for csv and plain text</li>
<li><code>pzfx</code> for GraphPad Prism.</li>
<li>Various <code>Bioconductor</code> packages for â€™omics data in various formats.</li>
</ul>
<p>Here we will import a dataset from Excel using the <code>readxl</code> package. If you already installed <code>tidyverse</code> then you already have this package.</p>
<p>Once the package is installed we can use the function <code>readxl::read_excel()</code>, which reads data from an Excel file.</p>
<section id="make-sure-the-data-looks-ok-and-is-in-the-right-place-on-your-computer" class="level2">
<h2 class="anchored" data-anchor-id="make-sure-the-data-looks-ok-and-is-in-the-right-place-on-your-computer">Make sure the data looks OK and is in the right place on your computer</h2>
<p>Before we dive in and import it, we need to make sure our data is in a sensible place.</p>
<ol type="1">
<li><p>Open RStudio and switch to the project you created in day 1, or start a new project if necessary.</p></li>
<li><p>Then, save the example data <a href="`walkingspeed_day2.xlsx`"><code>walkingspeed_day2.xlsx</code></a> for this tutorial into your project folder. Check that it has appeared in the â€˜filesâ€™ pane in RStudio.</p></li>
<li><p>Start a new script file that will eventually include all of the commands we need to import, clean, visualise and analyse the data.</p></li>
<li><p>Now open the dataset in Excel and explore the file so that you understand what is there.</p></li>
</ol>
</section>
<section id="read-the-help" class="level2">
<h2 class="anchored" data-anchor-id="read-the-help">Read the help!</h2>
<p>We are nearly ready to import our data. But before using a new function its always good to read its documentation.</p>
<p>R and R packages are not as self-explanatory as other software, and so you should expect to spend a fair amount of time, particularly as you are learning R, reading documentation, vignettes, blogs, etc on what R can do, which packages exist, and how to use them.</p>
<p>The <code>read_excel()</code> function has a few different options so first we should look at the help file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>?read_excel <span class="co"># where does the helpfile appear?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make sure to check:</p>
<ul>
<li><strong>Description</strong> what does the function do,</li>
<li><strong>Usage</strong> what is the syntax</li>
<li><strong>Arguments</strong> detail of what all the options mean</li>
<li><strong>Value</strong> what do I get when I run this</li>
<li><strong>Examples</strong> (usually very helpful)</li>
</ul>
<p>Note from the help file that <code>read_excel()</code> can extract data from different sheets and ranges of an Excel workbook, can use or ignore column names, and allows you to specify the type of data (numeric, dates, text etc) if you want to, or leave it to R to guess.</p>
<p>Many R packages also have vignettes or websites including simpler guides to their use in specific cases. <code>readxl</code> has a website that you might find helpful: <a href="https://readxl.tidyverse.org/">https://readxl.tidyverse.org/</a></p>
<p>Now weâ€™ll load the data. We want to use the â€˜walking speedâ€™ data from the walkingspeed.xlsx spreadsheet.</p>
<ol start="5" type="1">
<li>Open the spreadsheet using Excel and find this sheet. The data we want is in the sheet called â€˜day2â€™.</li>
</ol>
<p>From the <code>read_excel()</code> help file we can deduce the syntax to load this data into R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path=</span><span class="st">"walkingspeed_day2.xlsx"</span>, <span class="at">sheet=</span><span class="st">"day2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This line assumes that the file <code>walkingspeed_day2.xlsx</code> is in the current working directory (you can check what the current working directory is with <code>getwd()</code>. The current working directory is also shown just above the R console window. You can see the files in the current working directory in the â€˜Filesâ€™ tab on the bottom right of the RStudio window. When you create or load a project RStudio will set the working directory to the root of the project directory.</p>
<p>So this line calls the <code>read_excel()</code> function, with the arguments <code>path</code>, <code>sheet</code> set. The other arguments will be set to their default values, which you can see from the help file.</p>
<p>We could have set the range of the data in the spreadsheet (I usually do this for safety), but <code>read_excel()</code> can figure it out automatically most of the time; by default it picks the biggest continuous chunk of data starting in the top left of the sheet.</p>
<p>Now you should have a â€˜data frameâ€™ object called <code>walkingdat</code> in your environment, which includes the data from the Excel sheet ready to process and analyse.</p>
<p>Our workflow now is:</p>
<ol type="1">
<li>Clean and code</li>
<li>Visualise</li>
<li>Describe</li>
<li>Model</li>
<li>Diagnose model</li>
<li>Interpret</li>
</ol>
</section>
</section>
<section id="cleaning" class="level1">
<h1>Cleaning</h1>
<p>Before we can analyse our data we should check each variable to make sure that it looks OK.</p>
<p>Weâ€™ll use functions from day 1 to explore the content and structure of the dataset, and the distributions of the main variables. We can then address any problems that we find.</p>
<p>Recall these functions from the day 1 notes. We are checking that the variables have the correct type, and the distributions of the categorical variables.</p>
<p>This is an important aspect of any data analysis and we should not skip this step.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(walkingdat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     patid           group                time             sex           
 Min.   :  1.00   Length:135         Min.   :  0.000   Length:135        
 1st Qu.: 34.50   Class :character   1st Qu.:  2.167   Class :character  
 Median : 68.00   Mode  :character   Median :  2.426   Mode  :character  
 Mean   : 68.01                      Mean   :  4.175                     
 3rd Qu.:101.50                      3rd Qu.:  2.949                     
 Max.   :136.00                      Max.   :185.362                     
     age              department   
 Length:135         Min.   :1.000  
 Class :character   1st Qu.:2.000  
 Mode  :character   Median :3.000  
                    Mean   :2.607  
                    3rd Qu.:3.500  
                    Max.   :4.000  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(walkingdat<span class="sc">$</span>age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(walkingdat<span class="sc">$</span>group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
control   treat 
     68      67 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(walkingdat<span class="sc">$</span>sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  F   M 
 35 100 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(walkingdat<span class="sc">$</span>department)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 1  2  3  4 
28 31 42 34 </code></pre>
</div>
</div>
<section id="converting-between-types" class="level2">
<h2 class="anchored" data-anchor-id="converting-between-types">Converting between types</h2>
<p>You will have noticed that one of the numerical variables, age, has been loaded as character variable and not a numeric. We cannot do a quantitative analysis with a character variable!</p>
<p>Why do you think the variable is imported as character and not numeric?</p>
<p>We can convert age to a numeric using the function <code>as.numeric()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidyverse version:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="ot">&lt;-</span> walkingdat <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">as.numeric</span>(age))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Base R version:</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>walkingdat<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(walkingdat<span class="sc">$</span>age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What warning message did you get when you converted this variable? What does it mean?</p>
</section>
<section id="checking-the-data" class="level2">
<h2 class="anchored" data-anchor-id="checking-the-data">Checking the data</h2>
<p>We mustnâ€™t assume that all our data had been entered correctly.</p>
<p>How might we check on the age and time variables to see if the distribution looks OK?</p>
<p>We could make some descriptive statistics and basic plots!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(walkingdat<span class="sc">$</span>age)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(walkingdat<span class="sc">$</span>time)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(walkingdat<span class="sc">$</span>time, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What do you notice from here?</p>
</section>
<section id="dealing-with-outliers" class="level2">
<h2 class="anchored" data-anchor-id="dealing-with-outliers">Dealing with outliers</h2>
<p>It looks like there are some unreasonably high and low values of walking time.</p>
<p>We can make another graph of walking speed against age, this time on a logarithmic scale so both the extreme high and extreme low points are visible, to see what is going on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ggplot2 version</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(walkingdat) <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>time) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">scale_y_log10</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="do">## base R version</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(walkingdat<span class="sc">$</span>age, walkingdat<span class="sc">$</span>time, <span class="at">log=</span><span class="st">"y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It seems there are some values for time that are likely to be technical errors. We can remove these values (set them to missing) in a few different ways:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## base R method</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>walkingdat<span class="sc">$</span>time[walkingdat<span class="sc">$</span>time<span class="sc">&lt;</span><span class="fl">0.1</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>walkingdat<span class="sc">$</span>time[walkingdat<span class="sc">$</span>time<span class="sc">&gt;</span><span class="dv">100</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Using mutate and ifelse</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="ot">&lt;-</span> walkingdat <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">ifelse</span>(time<span class="sc">&lt;</span><span class="fl">0.1</span>,<span class="cn">NA</span>,time))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="ot">&lt;-</span> walkingdat <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">ifelse</span>(time<span class="sc">&gt;</span><span class="dv">100</span>,<span class="cn">NA</span>,time))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="do">## the 'pure' tidyverse way with case_when is a bit clunky.</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="do">## look up 'case_when()' to understand this line</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="ot">&lt;-</span> walkingdat <span class="sc">|&gt;</span> <span class="fu">mutate</span>( <span class="at">time =</span> <span class="fu">case_when</span>(time<span class="sc">&lt;</span><span class="fl">0.1</span> <span class="sc">~</span> <span class="cn">NA_real_</span> , </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>                                                     time<span class="sc">&gt;</span><span class="dv">100</span> <span class="sc">~</span> <span class="cn">NA_real_</span>, </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>                                                     <span class="cn">TRUE</span> <span class="sc">~</span> time) )</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Now check the distribution of time again.</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(walkingdat<span class="sc">$</span>time, <span class="at">breaks=</span><span class="dv">100</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(walkingdat<span class="sc">$</span>time, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have a cleaned dataset in our environment you can proceed with our visualization and analysis, using the functions you learned in day 1.</p>
<p>If you had trouble with the cleaning exercise then use the version of the dataset found in the <code>cleaned</code> tab of the spreadsheet:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path=</span><span class="st">"walkingspeed_day2.xlsx"</span>, <span class="at">sheet=</span><span class="st">"cleaned"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="analysis---exercises" class="level1">
<h1>Analysis - Exercises</h1>
<p>Add commands to your script file to answer the questions below.</p>
<p>Add comments (lines beginning with <code>#</code>) to help you remember which questions you are answering, what you did and why!.</p>
<p>Some solutions are posted at the bottom of the page, but it will help you a lot to try to answer them on your own, by discussing with colleagues, or by looking up help online before using the solutions.</p>
<p>If you donâ€™t understand the given solution, then please ask and we can go through it in the class.</p>
<p>We will discuss the testing, modelling and graphing elements in more detail on day 3, but it would be helpful to attempt these today.</p>
<hr>
<ol type="1">
<li>Structure of the dataset
<ol type="a">
<li>What are the names of the variables that comprise the <code>walkingdata</code> dataframe?</li>
<li>What is the class of each?</li>
<li>How many columns and rows does it have?</li>
</ol></li>
<li>Descriptive statistics
<ol type="a">
<li>What is the age of youngest patient?</li>
<li>What is the age of the oldest patient?</li>
<li>Are the oldest and youngest patient male or female?</li>
</ol></li>
<li>Cross-tabulation (hint, use the <code>table</code> function)
<ol type="a">
<li>How many Male and Female patients are there?</li>
<li>Is the sex ratio balanced between treatment groups?</li>
<li>How many women are there of age under 50? How many men are there of age under 50?</li>
</ol></li>
<li>Descriptive statistics using a subset of the data
<ol type="a">
<li>What is the average walking speed for men between 50 and 60 years of age?</li>
</ol></li>
<li>Graphing
<ol type="a">
<li>Consider what kind of graph you might make to illustrate the difference in walking speed between treatment groups, and try to make it using ggplot. Eg:</li>
<li>Make a scatter plot of time vs age</li>
<li>Make the colour of each point reflect the treatment group</li>
<li>Make a box plot of time by sex, with a different coloured box per sex</li>
<li>Label the axes appropriately</li>
<li>Try a violin plot instead of a boxplot (with geom_violin). Which do you prefer?</li>
<li>Make any other adjustments you think are informative!</li>
</ol></li>
<li>Hypothesis Testing
<ol type="a">
<li>What is the difference in average walking speed between control patients and treated patients?</li>
<li>Is this difference statistically significant? Use t-test <code>t.test()</code> and Mann-Whitney tests <code>wilcox.test()</code> to examine the differences between the groups. Look up the syntax for <code>t.test()</code> and <code>wilcox.test()</code> using the help system, and use them to check whether the time taken to complete the task varies by treatment status. In each case use the version of the function that takes a <code>formula</code> agument. Remember the <code>formula</code> syntax from the <code>boxplot</code> and <code>lm</code> functions in day 1.</li>
<li>Compare the p-values for each method.</li>
<li>Consider the assumptions for a t-test, and whether they are met in this dataset.<br>
</li>
<li>Do you believe that treatment affects walking speed?</li>
</ol></li>
<li>Deriving new variables
<ol type="a">
<li>Create a new column that will have the speed of walking, that is 1/time.</li>
<li>Create a new column that will have the time rounded up to nearest 10th of a second.</li>
</ol></li>
<li>Linear model diagnostics
<ol type="a">
<li>Estimate a linear model (with <code>lm</code>) to estimate/test the effect of treatment on task completion time.</li>
<li>Use <code>summary</code> to get the model coefficients and p-values</li>
<li>Use <code>broom::tidy</code> to get the model coefficients and p-values</li>
<li>Compare the model results to the equivalent t-test</li>
<li>Extend the model to include the effects of age and sex as potential covariates.</li>
<li>Use <code>plot()</code> to explore the model diagnostics</li>
<li>Use <code>performance::check_model</code> to explore the model diagnostics</li>
<li>Now estimate a new model to compare the task completion speed between groups.</li>
<li>Get the model coefficients and p-values</li>
<li>Check the model diagnostics using <code>plot</code> or <code>performance::check_model</code></li>
<li>Why are the result from this model different? How do you interpret the results?</li>
<li>Can you get the confidence intervals for the treatment effect (use the help for <code>broom::tidy</code>)</li>
<li>Use <code>model_summary</code> package to make a pretty model summary table</li>
</ol></li>
</ol>
</section>
<section id="solutions" class="level1">
<h1>Solutions</h1>
<p>The exercises will have many possible solutions, under each exercise we have listed a few possible answers. Most are possible using the functions we have introduced in day 1 of the course, or with functions I suggest in the questions, but in some cases there are other solutions that I have given using different functions/packages.</p>
<p>If you answered the questions another way then thatâ€™s fine, but do try to understand how the given solutions work.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_knit<span class="sc">$</span><span class="fu">set</span>(<span class="at">eval=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="structure-of-the-dataset" class="level3">
<h3 class="anchored" data-anchor-id="structure-of-the-dataset">Structure of the dataset</h3>
<p>What are the names of the variables that comprise the <code>walkingdat</code> dataframe?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Eg you could use:</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(walkingdat)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(walkingdat)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(walkingdat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What is the class of each? What is the class of <code>walkingdat</code>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(walkingdat)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(walkingdat, class)  <span class="co">#  'lapply' takes a list (first argument) and applies a function (second argument) to every element of that list.</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">map</span>(class) <span class="co"># map is the tidyverse version of lapply.  It is in the 'purrr' package which is loaded if you used library(tidyverse).</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(walkingdat) <span class="co"># walkingdat is a dataframe, but since you used read_excel() to get it it is also a `tbl` which is a dataframe with a few tidyverse enhancements.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How many columns and rows does <code>walkingdat</code> have?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(walkingdat) <span class="co"># Get the dimension</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(walkingdat) <span class="co"># Get the number of rows</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(walkingdat) <span class="co"># The 'length' of a data frame is the numve</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="descriptive-statistics" class="level3">
<h3 class="anchored" data-anchor-id="descriptive-statistics">Descriptive statistics</h3>
<p>What is the age of youngest patient?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the help for what na.rm does.  You'll see many of the summary statistics need this.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(walkingdat<span class="sc">$</span>age, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">summarize</span>(<span class="fu">min</span>(age, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">select</span>(age) <span class="sc">|&gt;</span> <span class="fu">min</span>(<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What is the age of the oldest patient?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(walkingdat<span class="sc">$</span>age)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">summarize</span>(<span class="fu">max</span>(age, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">select</span>(age) <span class="sc">|&gt;</span> <span class="fu">max</span>(<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(walkingdat<span class="sc">$</span>age, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(walkingdat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="are-the-oldest-and-youngest-patient-male-or-female" class="level3">
<h3 class="anchored" data-anchor-id="are-the-oldest-and-youngest-patient-male-or-female">Are the oldest and youngest patient male or female?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">filter</span>(age<span class="sc">==</span><span class="dv">47</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">filter</span>(age<span class="sc">==</span><span class="dv">72</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>walkingdat[<span class="fu">which.max</span>(walkingdat<span class="sc">$</span>age), <span class="st">"sex"</span>]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>walkingdat[<span class="fu">which.min</span>(walkingdat<span class="sc">$</span>age), <span class="st">"sex"</span>]</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># head and tail show the start and end of a dataset.  </span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">arrange</span>(age) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">arrange</span>(age) <span class="sc">|&gt;</span> <span class="fu">tail</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cross-tabulation" class="level3">
<h3 class="anchored" data-anchor-id="cross-tabulation">Cross-tabulation</h3>
<p>How many Male and Female patient are there?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">filter</span>( sex <span class="sc">==</span><span class="st">'F'</span> ) <span class="sc">|&gt;</span> <span class="fu">count</span>()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">filter</span>( sex <span class="sc">==</span><span class="st">'M'</span> ) <span class="sc">|&gt;</span> <span class="fu">count</span>()</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(walkingdat<span class="sc">$</span>sex)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">group_by</span>(sex) <span class="sc">|&gt;</span> <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Is the sex ratio balanced between treatment groups?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">filter</span>( group <span class="sc">==</span><span class="st">'treat'</span>, sex <span class="sc">==</span><span class="st">'M'</span> ) <span class="sc">|&gt;</span> <span class="fu">count</span>()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">filter</span>( group <span class="sc">==</span><span class="st">'treat'</span>, sex <span class="sc">==</span><span class="st">'F'</span> ) <span class="sc">|&gt;</span> <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How many women are there of age under 50? How many men are there of age under 50?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">filter</span>(age <span class="sc">&lt;</span> <span class="dv">50</span> , sex <span class="sc">==</span><span class="st">'F'</span> ) <span class="sc">|&gt;</span>  <span class="fu">count</span>()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">filter</span>(age <span class="sc">&lt;</span> <span class="dv">50</span> , sex <span class="sc">==</span><span class="st">'M'</span> ) <span class="sc">|&gt;</span>  <span class="fu">count</span>()</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(walkingdat<span class="sc">$</span>sex, walkingdat<span class="sc">$</span>age<span class="sc">&lt;</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="descriptive-statistics-using-a-subset-of-the-data" class="level3">
<h3 class="anchored" data-anchor-id="descriptive-statistics-using-a-subset-of-the-data">Descriptive statistics using a subset of the data</h3>
<p>What is the average walking speed for men between 60 and 70 years of age?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">filter</span>(age <span class="sc">&gt;</span><span class="dv">59</span>, age <span class="sc">&lt;</span><span class="dv">71</span>,  sex <span class="sc">==</span><span class="st">'M'</span> )  <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(time) <span class="sc">|&gt;</span> <span class="fu">pull</span>() <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="sc">|&gt;</span> <span class="fu">filter</span>( age <span class="sc">&gt;</span><span class="dv">59</span>, age <span class="sc">&lt;</span><span class="dv">71</span>,  sex <span class="sc">==</span><span class="st">'M'</span> ) <span class="sc">|&gt;</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">mean</span>(time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="deriving-new-variables" class="level3">
<h3 class="anchored" data-anchor-id="deriving-new-variables">Deriving new variables</h3>
<p>Create a new column that will have the speed of walking, that is 1/time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="ot">&lt;-</span> walkingdat <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">speed=</span><span class="dv">1</span><span class="sc">/</span><span class="fu">as.numeric</span>(time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create a new column that will have the time rounded to the nearest 10th of a second.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>walkingdat <span class="ot">&lt;-</span> walkingdat <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">rounded=</span><span class="fu">round</span>(<span class="fu">as.numeric</span>(time), <span class="at">digits =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="graphing" class="level3">
<h3 class="anchored" data-anchor-id="graphing">Graphing</h3>
<p>Make a scatter plot of time vs age Make the colour of each point reflect the treatment group</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>walkingdat) <span class="sc">+</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>age,<span class="at">y=</span>time,<span class="at">colour=</span>group) <span class="sc">+</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make a box plot of time by sex, with a different coloured box per sex</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>walkingdat) <span class="sc">+</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>sex,<span class="at">y=</span>time,<span class="at">fill=</span>sex) <span class="sc">+</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Label the axes appropriately</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>walkingdat) <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>sex,<span class="at">y=</span>time,<span class="at">fill=</span>sex) <span class="sc">+</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Sex"</span>, <span class="at">y=</span><span class="st">"Time to complete task (s)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Try a violin plot instead of a boxplot (with geom_violin). Which do you prefer?*</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>walkingdat) <span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>sex,<span class="at">y=</span>time,<span class="at">fill=</span>sex) <span class="sc">+</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Sex"</span>, <span class="at">y=</span><span class="st">"Time to complete task (s)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="hypothesis-testing" class="level3">
<h3 class="anchored" data-anchor-id="hypothesis-testing">Hypothesis testing</h3>
<p>What is the difference in task completion time between control patients and treated patients? Is this difference statistically significant?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>( time <span class="sc">~</span> group , <span class="at">data=</span>walkingdat)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>( time <span class="sc">~</span> group , <span class="at">data=</span>walkingdat) <span class="sc">|&gt;</span> broom<span class="sc">::</span><span class="fu">tidy</span>()</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>( time <span class="sc">~</span> group , <span class="at">data=</span>walkingdat) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>( time <span class="sc">~</span> group , <span class="at">data=</span>walkingdat) <span class="sc">|&gt;</span> <span class="fu">anova</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use t-test <code>t.test()</code> and Mann-Whitney tests <code>wilcox.test()</code> to examine the differences between the groups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>( time <span class="sc">~</span> group , <span class="at">data=</span>walkingdat)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>( time <span class="sc">~</span> group , <span class="at">data=</span>walkingdat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Consider the assumptions underlying the t-test, and whether they are met in this dataset</p>
<p>The t-test and the linear model assume that the outcome variable is normally distributed within groups, which is not the case here. So the results from these is probably wrong.</p>
<p>The Mann-Whitney test (Wilcox test) does not make this assumption, and is more robust in this case.</p>
<p>Do you believe that treatment affects walking speed?</p>
<p>Try the t-test or linear model using the speed variable that you created instead of the time variable that is in the dataset.</p>
</section>
<section id="diagnostics" class="level3">
<h3 class="anchored" data-anchor-id="diagnostics">Diagnostics</h3>
<p>Estimate a linear model (with <code>lm</code>) to estimate/test the effect of treatment on task completion time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>walkingdat , time <span class="sc">~</span> group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use <code>summary</code> to get the model coefficients and p-values</p>
<p>Use <code>broom::tidy</code> to get the model coefficients and p-values</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>mod1 <span class="sc">|&gt;</span> broom<span class="sc">::</span><span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Compare the model results to the equivalent t-test</p>
<p>Extend the model to include the effects of age and sex as potential covariates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>walkingdat , time <span class="sc">~</span> group <span class="sc">+</span> age <span class="sc">+</span> sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use <code>plot()</code> to explore the model diagnostics</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="do">## You could plot model 1 or model 2.</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Use <code>performance::check_model</code> to explore the model diagnostics</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_model</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now estimate a new model to compare the task completion speed between groups.</p>
<p>Get the model coefficients and p-values</p>
<p>Check the model diagnostics using <code>plot</code> or <code>performance::check_model</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>walkingdat<span class="sc">$</span>speed <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>walkingdat<span class="sc">$</span>time</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data=</span>walkingdat , speed <span class="sc">~</span> group <span class="sc">+</span> age <span class="sc">+</span> sex)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_model</span>(mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Why are the result from this model different? How do you interpret the results?</p>
<p>Can you get the confidence intervals for the treatment effect (use the help for <code>broom::tidy</code>)</p>
<p>Use <code>model_summary</code> package to make a pretty model summary table</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>modelsummary<span class="sc">::</span><span class="fu">modelsummary</span>(mod3)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>modelsummary<span class="sc">::</span><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Speed model"</span><span class="ot">=</span>mod3,<span class="st">"First model"</span><span class="ot">=</span>mod1) , </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">estimate=</span><span class="st">"{estimate} [{conf.low}, {conf.high}] {stars}"</span>, </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">coef_rename =</span> <span class="fu">c</span>(<span class="st">'(Intercept)'</span><span class="ot">=</span><span class="st">"Intercept"</span>, </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">'grouptreat'</span><span class="ot">=</span><span class="st">"Treatment"</span>, </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">'age'</span><span class="ot">=</span><span class="st">"Age (per year)"</span>, </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">'sexM'</span><span class="ot">=</span><span class="st">"Male vs Female"</span>), </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">statistic=</span><span class="cn">NULL</span>, )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>