{
  "hash": "02522c8e188b1edbdcbe85c02e4d12fa",
  "result": {
    "markdown": "---\ntitle: \"Intro to R day 3 - Notes on Graphing\"\nauthor: \"George Savva\"\ndate: \"April 2022\"\nalways_allow_html: true\noutput:\n  html_document:\n    df_print: paged\n    theme: cosmo\n    toc: yes\n    toc_depth: 2\n---\n\n\n\n\nPlotting data is an essential part of data analysis and reporting.  Your plots communicate your results, and a good plot can be the difference between a successful and unsuccessful communication.\n\nIn this session we'll think about how to plot your data, what makes a good vs a bad plot, and illustrate some concepts for plotting using R.\n\nLearning objectives:\n\n* What to plot\n* A few principles for designing a good graph\n* Plotting in R with ggplot\n\n# What to plot\n\nFigures are an important aspect of scientific communication.  They can communicate patterns \n\nYour data is likely to be complex, and you will have limited space for plotting in your reports, and so you should think carefully about which plots are important and how to choose to display your data.  \n\nGenerally there are two reasons to plot data, that mirror the two main types of statistical analyses we can perform.  \n\nThe first is to describe data (mirroring our descriptive analyses), the second is to describe results that come from the data (mirroring our inferential analyses).  Often we are forced to meet these two objectives in the same graph, which can cause some tension!\n\n# Walking speed data\n\nConsider our walking speed data.  Recall our aim was to test whether a rehabilitation intervention improves walking speed.  We had data from a clinical trial among older men and women recruited from several hospital departments.\n\nWhat are the different reasons we might make plots of the data?  Which plots did we make in Day 2, and why?  What did we learn from them, or what were we trying to communicate\n\nIn each case, who is the audience and what information to we want to extract or display?\n\n:::{.callout-tip collapse=\"true\" title=\"Some uses for graphics (click to expand)\"}\n\n* Graphs to describe your dataset\n    + See the data!\n    + For ourselves / collaborators / readers\n    + Distribution of data\n    + Describe population\n    + Find outliers or other problems\n    + Preliminary comparison of means\n    + Choose a valid statistical method\n\n* Graphs to describe scientific results\n    + See the results!\n    + For ourselves / collaborators / readers\n    + Validate a statistical model\n    + For scientific publications and presentations:\n    + Show effect size\n    + Show confidence or uncertainty in effect size\n    + Show statistical significance\n    + Public communication of findings\n\n:::\n\nThese aspects might all need kinds of different plots at different stages of the project.\n\nEach plot we produce needs to meet its own need.  We should think about what we want to see, and then work out how to get it.\n\n## Descriptive plots\n\nBefore we model data we should visualise it.  This crucial first step is often omitted in analyses and reports.  Consider the follow example, that I have designed after a real analysis I was asked to comment on, where an outcome was compared between two treatment conditions:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(ggpubr)\nset.seed(12345) # Set seed is used to ensure that 'random' samples will come out the same each time.\nN=12\ny <- c(runif(N), c(runif(N-2), 4.5,6))\nx <- factor(rep(c(1,2), each=N))\nggplot(data.frame(Group=x,y), aes(x,y)) + \n  stat_summary(geom=\"col\",width=0.5, fill=\"red\") + \n  stat_summary(geom=\"errorbar\", width=0.2) + \n  theme_bw()+ stat_compare_means(label.y = 2)\n```\n\n::: {.cell-output-display}\n![](day3_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\nOn the face of it, it looks like the outcome is higher in group 2 than group 1.  If this is all you see then this is surely the conclusion you would come to.  \n\nBut why is the p-value so high?  And how well do you feel like you understand the data from this graph?\n\nConsider now how you would interpret this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nggplot(data.frame(Group=x,y), aes(x,y)) + \n  geom_point() + \n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](day3_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nQuite differently?  At least with this second visualisation we can see the data and draw our conclusions about what is going on directly.\n\nAlso consider, the first graph only shows you four values, two means and two standard errors (if that is what they are, I never actually told you).  It's a waste of ink.  But how often do you see this first presentation in the scientific papers your read?  When I see one of these I can't help but wonder what horrors it is hiding.\n\nThe second graph tells us quite a lot.  It tells us to maybe check our outlying data points, or to try transforming our data before analysis. We might even conclude that the two groups are more-or-less the same, except for two individuals, which may well be a real effect of treatment that is limited to specific individuals.  In any case we learn a lot.\n\nSo our most important rule is: always plot your data, and not just summaries of the data.\n\nIdeally, if we have a dataset with several variables, we will start by making something like a graph matrix showing every variable against every other variable.  This will help us identify any potential problems or outliers in 2-dimensions.\n\nThe `ggpairs` function in the `GGally` package gives us a grid layout showing all of these combinations.  I think its a reasonable summary.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readxl)\nlibrary(GGally)\nwalkingdata <- read_excel(path=\"walkingspeed_day2.xlsx\", sheet=\"cleaned\")\nwalkingdata$department <- factor(walkingdata$department)\nwalkingdata$time <- as.numeric(walkingdata$time)\nwalkingdata$time[walkingdata$time>100] <- NA\nwalkingdata$time[walkingdata$time<1] <- NA\nggpairs(walkingdata, columns=1:6)\n```\n\n::: {.cell-output-display}\n![](day3_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nNote I'm not wasting a lot of time making this graph pretty.  It's for me only, I don't care what it looks like, I just want to see the data as quickly and as effectively as possible.  I've also left patient ID in here as a variable, there's no harm doing this, and it might show me if any data errors have occurred.\n\nDoes this graph meet the objectives that we set out for our 'descriptive' analyses above?\n\n## Inferential graphs\n\nWhile the descriptive graphs tells us about the data, it doesn't tell us much about the comparison we are interested in making.\n\nTo think about how we could graph that, first think about what exactly it is we are trying to show.\n\nLets go back to our linear model from last time:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel1 <- lm(data=walkingdata, log(time) ~ group + sex + age + department)\ngtsummary::tbl_regression(model1)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"falthzlcin\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#falthzlcin table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#falthzlcin thead, #falthzlcin tbody, #falthzlcin tfoot, #falthzlcin tr, #falthzlcin td, #falthzlcin th {\n  border-style: none;\n}\n\n#falthzlcin p {\n  margin: 0;\n  padding: 0;\n}\n\n#falthzlcin .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#falthzlcin .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#falthzlcin .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#falthzlcin .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#falthzlcin .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#falthzlcin .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#falthzlcin .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#falthzlcin .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#falthzlcin .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#falthzlcin .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#falthzlcin .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#falthzlcin .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#falthzlcin .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#falthzlcin .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#falthzlcin .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#falthzlcin .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#falthzlcin .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#falthzlcin .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#falthzlcin .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#falthzlcin .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#falthzlcin .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#falthzlcin .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#falthzlcin .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#falthzlcin .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#falthzlcin .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#falthzlcin .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#falthzlcin .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#falthzlcin .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#falthzlcin .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#falthzlcin .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#falthzlcin .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#falthzlcin .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#falthzlcin .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#falthzlcin .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#falthzlcin .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#falthzlcin .gt_left {\n  text-align: left;\n}\n\n#falthzlcin .gt_center {\n  text-align: center;\n}\n\n#falthzlcin .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#falthzlcin .gt_font_normal {\n  font-weight: normal;\n}\n\n#falthzlcin .gt_font_bold {\n  font-weight: bold;\n}\n\n#falthzlcin .gt_font_italic {\n  font-style: italic;\n}\n\n#falthzlcin .gt_super {\n  font-size: 65%;\n}\n\n#falthzlcin .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#falthzlcin .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#falthzlcin .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#falthzlcin .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#falthzlcin .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#falthzlcin .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#falthzlcin .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;Characteristic&lt;/strong&gt;\"><strong>Characteristic</strong></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;Beta&lt;/strong&gt;\"><strong>Beta</strong></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;95% CI&lt;/strong&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\"><strong>95% CI</strong><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"&lt;strong&gt;p-value&lt;/strong&gt;\"><strong>p-value</strong></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">group</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\"><br /></td>\n<td headers=\"ci\" class=\"gt_row gt_center\"><br /></td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    control</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">—</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">—</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    treat</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-0.18</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-0.30, -0.07</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.003</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">sex</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\"><br /></td>\n<td headers=\"ci\" class=\"gt_row gt_center\"><br /></td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    F</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">—</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">—</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    M</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.04</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-0.10, 0.19</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.6</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">age</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.01</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">0.00, 0.03</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.021</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">department</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\"><br /></td>\n<td headers=\"ci\" class=\"gt_row gt_center\"><br /></td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    1</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">—</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">—</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\"><br /></td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    2</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">0.11</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-0.07, 0.28</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.2</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    3</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-0.09</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-0.26, 0.07</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.3</td></tr>\n    <tr><td headers=\"label\" class=\"gt_row gt_left\">    4</td>\n<td headers=\"estimate\" class=\"gt_row gt_center\">-0.06</td>\n<td headers=\"ci\" class=\"gt_row gt_center\">-0.23, 0.12</td>\n<td headers=\"p.value\" class=\"gt_row gt_center\">0.5</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"4\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span> CI = Confidence Interval</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n:::\n:::\n\n\nWhat is the key information here that we need to communicate?\n\nWe should say what our estimate of the treatment effect is, and how sure we are of this.  That is the 'actionable' result from this work, and that is what we want people to take away from our analysis.  The fact of the treatments being 'significantly' different is interesting but not enough on its own.  So from our analysis we should be trying to communicate the estimate of treatment effect, the standard error of treatment effect, and potentially the p-value and a confidence interval for the difference.  \n\nThe mean time in each group is perhaps interesting descriptively, so people can understand our sample.  It's hard to see why the standard error within each group should be of interest.\n\nSo - do I even need a graph?  Should this summary statistic, mean difference = 0.19 (standard error=0.06; p=0.0015) be enough?  Recall that this was calculated on a logarithmic scale, so it's probably best to exponentiate it and report a ratio:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(emmeans)\nem1 <- emmeans(model1, \n               trt.vs.ctrl~group, \n               type=\"response\")$contrast\nconfint(em1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n contrast        ratio     SE  df lower.CL upper.CL\n treat / control 0.832 0.0499 124    0.739    0.937\n\nResults are averaged over the levels of: sex, department \nConfidence level used: 0.95 \nIntervals are back-transformed from the log scale \n```\n:::\n:::\n\n\nSo we could say \"times for treated group were 83% of the times for the control group (95% CI=74% to 93%)\".  Or:  \"treatment improved times by 17% (95% CI=7-26%).\"\n\nIs this enough?  I think so, if combined with a visual summary that persuades us that the model is reasonable, and we have the descriptive graph that shows us this difference in the context of the variance in the data.\n\nCompare this with the traditional presentation:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggpubr) # includes the stat_compare_means function\nggplot(walkingdata, aes(x=group, y=time)) + \n  stat_summary(geom=\"col\", width=0.5, fill=\"red\") + \n  stat_summary(geom=\"errorbar\", width=.2) + \n  scale_x_discrete(na.translate=FALSE) + \n  theme_bw() + \n  stat_compare_means()\n```\n\n::: {.cell-output-display}\n![](day3_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nor better, but still not so informative:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggpubr)\nlibrary(ggbeeswarm)\nggplot(remove_missing(walkingdata), aes(x=group, y=time)) + \n  geom_beeswarm(col=\"grey\") + \n  stat_summary(geom=\"errorbar\", width=.2) + \n  stat_summary(geom=\"point\", width=.2) + \n  theme_bw()+ scale_y_log10() + \n  stat_compare_means(method=\"t.test\",\n                     label = \"p.signif\",\n                     comparisons=list(c(\"treated\", \"control\")))\n```\n\n::: {.cell-output-display}\n![](day3_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nCould you say what the treatment effect is by looking at this graph?  How sure would you be about it?  Also, how would you represent a model other than a simple comparison of means (for example, the multiple linear regression model that we estimated).  By confusing the descriptive with the inferential graph we are limiting our ability to conduct the appropriate statistical analysis.\n\nAn even better plot might be a Gardner-Altman estimation plot.  It is unusual, but implemented in the R package `dabestr`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dabestr)\nlibrary(ggplot2)\nwalkingdata$logtime <- log(walkingdata$time)\nwalkingdata <- remove_missing(walkingdata)\nload(walkingdata, x=group, y=logtime, idx=c(\"control\", \"treat\")) |> \n  mean_diff() |> \n  dabest_plot(swarm_label=\"log(time)\")\n```\n\n::: {.cell-output-display}\n![](day3_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nNote that this plot allows us to see the distributions of the data in both groups, but crucially also an estimate of the difference between the groups and the uncertainty around that.  A downside is that we cannot accommodate the adjustment for sex or department that was included in the model.\n\nIf we did want to show the adjusted estimates, and compare estimates with each other as well as a null hypothesis, then we could use a forest plot. For example, suppose we wanted to compare several groups, say walking speed over department, then a visualisation like this might be useful.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(emmeans)\nlibrary(broom)\nem2 <- emmeans(model1, \n               pairwise~department, \n               type=\"response\")$contrast\ntd <- tidy(em2, conf.int = TRUE)\ntd\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 11\n  term       contrast  null.value ratio std.error    df conf.low conf.high  null\n  <chr>      <chr>          <dbl> <dbl>     <dbl> <dbl>    <dbl>     <dbl> <dbl>\n1 department departme…          0 0.897    0.0797   124    0.712      1.13     1\n2 department departme…          0 1.10     0.0933   124    0.881      1.37     1\n3 department departme…          0 1.06     0.0933   124    0.843      1.33     1\n4 department departme…          0 1.23     0.100    124    0.991      1.52     1\n5 department departme…          0 1.18     0.102    124    0.944      1.48     1\n6 department departme…          0 0.964    0.0798   124    0.777      1.20     1\n# ℹ 2 more variables: statistic <dbl>, adj.p.value <dbl>\n```\n:::\n\n```{.r .cell-code}\nggplot(td) + \n  aes(x=contrast, y=ratio, ymax=conf.high, ymin=conf.low) + \n  geom_pointrange() + \n  coord_flip() + \n  geom_hline(yintercept=1) + \n  theme_bw() + \n  labs(y=\"Ratio of average walking task times with Tukey adjusted 95% confidence intervals\")\n```\n\n::: {.cell-output-display}\n![](day3_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nWhat might improve this graph here?  Perhaps an annotation for which side of the graph corresponds to faster and which to slower.  It is possible to work it out, but if you can avoid that cognitive load for your readers then that would be better!\n\n\n# Finally, some tips for making a good graph\n\n* Consider a horizontal layout - key comparisons should be made vertically.\n* Avoid colour. If you need to use colour, then use colorblind safe palettes.\n* Never use 'dynamite' charts (bar charts with error bars overlaid)\n* Plot your individual data points where you can\n* Plot estimates and confidence intervals of important *estimands* (the things we are trying to estimate), not groups \n* Don't use pie charts\n* Legends should be avoided if possible, but are sometimes essential. Directly annotate if you can.\n* Maps, 3D or animation can really help, but can also get in the way so use with care.\n* Always label axes fully, and make it clear what error bars correspond to.\n* Consider your ink/information ratio.  Is your graph really needed?  Should it be a line of text, or a table?\n* Use gridlines.\n* Be careful when trying to represent data and analysis in the same picture.\n* Never let a graph dictate your analysis.\n* Check with other people that your graph is easy to understand.  Ask them what they understand from it.\n* Read up on data visualisation!\n\nMany of these points are embodied in this nice tutorial from Cedric Scherer, where he illustrates how a traditional boxplot might be vastly improved by some simple tweaks.\n\n<https://www.cedricscherer.com/2019/05/17/the-evolution-of-a-ggplot-ep.-1/>\n\n## Plotting with ggplot\n\n* Slides on ggplot including links to other tutorials are here:  [Graphing - day3.pptx](./day3.pptx)\n* A flipbook showing a graph built with ggplot elements is here:  [Example ggplot](flipbook.qmd)\n\n",
    "supporting": [
      "day3_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}