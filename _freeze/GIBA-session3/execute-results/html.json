{
  "hash": "8289408978a08a429dabb337b9e94cd6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Session3\"\nformat: html\nengine: knitr\nwebr: \n  show-startup-message: false    # Disable displaying status of webR initialization\n  packages: ['ggplot2', 'ggpubr','easystats','report','ggbeeswarm','pwr'] # Install R packages on document open\nfilters:\n  - webr\n---\n\n\n\n\n```{webr-r}\n#| echo: false\n#| message: false\n#| warning: false\nlibrary(ggplot2)\nlibrary(ggpubr)\nlibrary(report)\nlibrary(ggbeeswarm)\n```\n\n\nSlides for session 3 (sample size) are here: \n\n* [Session 3 slides](gibasession3.pptx)\n\n## How big should our mouse study be\n\nWe are interested in the number of mice needed to test the effect of supplement on fecal alpha diversity.\n\nWe will use a simple parallel group study to investigate this.\n\nWe believe from prior work that the within-group standard deviation for mouse alpha diversity is 1.\n\nUse the pwr function to answer the following questions:\n\n 1. Suppose we wanted our experiment to reliably detect an effect of 0.5 units, should it exist.  How many mice would we need?\n 2. If we could only afford to use ten mice per group, what would be the smallest effect size that we could detect?\n 3. What is the power to detect a difference of 0.5 units, given that we only have ten mice per group.\n 4. Remember we might not get data from all ten mice that were included.  If only 80% are expected to survive and give usable data, would would the power be?\n 5. How many mice would Mead's resource equation suggest that we use?\n 6. What would be the smallest detectable effect with this number?\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Reminder that the syntax for power is:\n# pwr(..)\n```\n:::\n\n\n\n\n## Sample size for a proportion\n\nSuppose we are interested in comparing an event incidence rate between two independent groups.  \n\nWe expect in our model that 50% of the participants will develop the outcome.  We expect our intervention will lower this by 10 percentage points.  How many participants would we need to be able to detect this difference?\n\n```{webr-r}\n\nlibrary(pwr)\n\nh = ES.h(0.5,0.4)\npwr.2p.test(h , n=NULL, power=0.9)\n\n```\n## Extracting the data from an existing study to make a sample size calculation\n\nWe can use information from previous studies to inform our sample size calculations.\n\nIf a previous study has been undertaken with a similar outcome measure and in a similar population to our planned study, then we might expect that the variation in the measures between and within people will be similar.\n\nWe might also get clues about the likely size of any effects\n\nHowever, we need to be careful when using published effect sizes, as these are likely to be biased by the *winners curse*.\n\nBecause effects are more likely to be published if they happen to be statistically significant, the effects from published studies are typically too high.  Replication studies have consistently shown that published effects, even when replicated, can be up to 85% too high.\n\nHere we'll consider conducting a replication of an existing study, and what the sample size of a replication should be. \n\n\n```{webr-r}\n\n#eyedat <- \n\n```\n\n## Effective sample size with clustered data\n\nConsider an observational study in which retinal thickness is compared between patients with or without rheumatoid arthritis.\n\nPatients are to be randomly sampled from their respective populations, and each patient has a measurement taken in their left and their right eye.\n\nHow should we analyse this data, what are the implications if of using the wrong model, and what are the implications for power and sample size?  How much extra information do we get from measuring the second eye in each participant?\n\nFirst we'll set up the simulation study:\n\n```{webr-r}\n\nN=20      # Study size per group\nrho=0.5   # Intra-class correlation between left and right eye\nsigma=10  # Standard deviation of individual eyes\nmean=100  # Grand mean\neffect=10 # True effect of RA on RNFL\neyes = c(\"L\",\"R\")\ngroups = c(\"Disease\",\"Control\")\n\nsd_between = sigma*sqrt(rho)\nsd_within = sigma*sqrt(1-rho)\n\ndat <- expand.grid(patient=1:(2*N), eye=eyes,group=groups)\ndat$group <- rep(groups,each=2*N)\n\npatientEffects = rnorm(2*N,0,sd_between)\n\ndat <- transform(dat , y = mean + patientEffects[patient] + effect*(group==\"Disease\") + rnorm(nrow(dat),0,sd_within))\n\n```\n\nIt is valuable to plot the data to check the extent of the correlation between the eyes\n\n```{webr-r}\n\nggplot(dat ) + aes(x=eye , y=y) + geom_point() + geom_line(aes(group=patient))\n\n```\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}