{
  "hash": "bf28330bcd74bccd813c0c6fbc810f2a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Selection bias in observational studies\"\nauthor: \"George Savva, (QIB)\"\n---\n\n\n\n\n\n\nThis is a short illustration of \"Berkson bias\" using simulated data.  This is the phenomenon that selection bias can induce correlations in samples that are not present in populations.  \n\nThis bias is likely to be an issue for many observational studies but is not well understood in the medical research literature.\n\nThe Wikipedia page for the phenonomenon is here:  <https://en.wikipedia.org/wiki/Berkson%27s_paradox>\n\n--- \n\nSuppose we are trying to understand the correlation between health and wealth.\n\nFirst, let's simulation a population in which health and wealth are both normally distributed but are not correlated with each other:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1)\npopulationsize = 1e4\nsamplesize = 200\n\npopulation <- data.frame(health=rnorm(populationsize), wealth=rnorm(populationsize))\nplot(population)\n```\n\n::: {.cell-output-display}\n![](berkson_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n\n\nNow if we take a simple random sample from this cohort from this group and test the correlation...\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsample1 <- population[sample(populationsize, samplesize),]\nplot(sample1$health, sample1$wealth)\n```\n\n::: {.cell-output-display}\n![](berkson_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncor.test(sample1$health, sample1$wealth)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPearson's product-moment correlation\n\ndata:  sample1$health and sample1$wealth\nt = -0.78426, df = 198, p-value = 0.4338\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n -0.19290026  0.08373896\nsample estimates:\n        cor \n-0.05564858 \n```\n\n\n:::\n:::\n\n\n\n\nWe see no evidence that wealth and health are related, as we would expect given this is true in the population.\n\nHowever we *know* that healthier, wealthier people are more likely to participate in our studies.  So let's create a sample that reflects this:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npopulation$b_participate = (population$health + population$wealth)\npopulation$prob_participate = exp(population$b_participate) / (1+exp(population$b_participate))\n\nsample2 <- population[sample(populationsize, samplesize, prob = population$prob_participate),]\n```\n:::\n\n\n\n\nHow will the average health and wealth in our sample compare to the population?\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean(sample2$health)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.3808598\n```\n\n\n:::\n\n```{.r .cell-code}\nmean(sample2$wealth)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.3049277\n```\n\n\n:::\n:::\n\n\n\n\nWell we know that health and wealth are higher in the sample than the population, but this should hopefullt be obvious.  But how are the two things correlated in the population?\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(sample2$health, sample2$wealth)\n```\n\n::: {.cell-output-display}\n![](berkson_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncor.test(sample2$health, sample2$wealth)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tPearson's product-moment correlation\n\ndata:  sample2$health and sample2$wealth\nt = -2.9629, df = 198, p-value = 0.003421\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n -0.3352015 -0.0692823\nsample estimates:\n       cor \n-0.2060428 \n```\n\n\n:::\n:::\n\n\n\n\nIt looks like a negative correlation in the sample, despite there being no correlation in the population!\n\nWas this unlucky?  We can look at the distribution of p-values from repeated samples, to see what the chance of a false positive correlation is here:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nonepvalue <- function(){\n  samplen <- population[sample(populationsize, samplesize, prob = population$prob_participate),]\n  cor.test(samplen$health, samplen$wealth)$p.value\n}\nreplicate(1000, onepvalue()) |> hist(breaks=20)\n```\n\n::: {.cell-output-display}\n![](berkson_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n\nIn more than 50% of cases there is now a significant correlation in the sample even though there is no correlation in the population.  It is simply caused by the factors under investigation also being factors that lead people to participate in research.\n\nWhat are the implications of this for observational studies?\n\nWhat can we do about it?  If we have sampling weights it is relatively easy to fix, but what if we don't?  Do we have to try to get them somehow?\n\n\n\n",
    "supporting": [
      "berkson_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}