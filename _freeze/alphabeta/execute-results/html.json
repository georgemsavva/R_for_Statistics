{
  "hash": "0a571490af32090ac5de668018b76ac6",
  "result": {
    "markdown": "---\ntitle: \"Simulations exploring alpha and beta diversity\"\nauthor: \"George Savva, (QIB)\"\n---\n\n\n\n\nThis file will include short simulations to understand how differences in community compositions are reflected in alpha and beta diversity metrics.\n\nIn each simulation I'll create some data with given characteristics then look at how this is reflected in the diversity measures.  This could be extended into power calculations if needed.\n\n## Simulation 1\n\n* We'll assume that there are 100 possible species in my communities.  \n\n* There are two different classes of environments from which we can sample communities, \n\n* In samples from the first environment each species is present with probability 0.4.\n\n* In samples from the the second environment each species is present with probability 0.5.\n\n* We'll sample ten communities per class, and look at their alpha and beta diversities\n\nFirst sample a matrix of the community compositions:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nN = 10 # Number of samples per class\nn = 100 # Number of possible species\nset.seed(\"19122023\")\nclasses <- rep(c(\"A\", \"B\"), each=N)\nclassProbabilities <- c(\"A\"=0.4,\"B\"=0.5)\ndat <- sapply(classes, \\(class) rbinom(n=n, size = 1, p=classProbabilities[class])) |> t()\n\n# Check it looks OK\ndat[1:10,1:10]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]\nA    1    1    1    0    0    0    0    0    1     1\nA    0    1    1    1    0    1    0    0    1     1\nA    0    0    1    0    0    1    0    1    1     0\nA    0    0    1    0    0    0    0    0    0     0\nA    1    1    1    1    0    0    1    0    1     0\nA    0    1    1    0    0    0    1    0    1     1\nA    1    0    1    1    0    0    1    0    0     0\nA    1    1    1    0    0    0    0    1    0     1\nA    1    0    0    0    1    0    1    1    0     0\nA    1    0    0    0    1    1    1    0    0     0\n```\n:::\n:::\n\n\nNow look at the alpha diversity (Shannon index):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(vegan)\nlibrary(ggplot2)\n## Shannon index\nt.test(diversity(dat) ~ classes)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tWelch Two Sample t-test\n\ndata:  diversity(dat) by classes\nt = -4.6706, df = 16.102, p-value = 0.0002517\nalternative hypothesis: true difference in means between group A and group B is not equal to 0\n95 percent confidence interval:\n -0.3544225 -0.1332105\nsample estimates:\nmean in group A mean in group B \n       3.672421        3.916238 \n```\n:::\n\n```{.r .cell-code}\nggplot() + aes(y=diversity(dat), x=classes) + \n  geom_boxplot()  +\n  geom_point() + \n  stat_summary()\n```\n\n::: {.cell-output-display}\n![](alphabeta_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nBeta-diversity (NMDS following Jaccard diversity):\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Not so clear with the beta-diversity\nvegdist(dat, method = \"jaccard\", binary = TRUE) |> \n  metaMDS(trace = 0) |>\n  scores() |> \n  plot(col=factor(classes), pch=20)\n  legend(\"topright\", legend=c(\"A\",\"B\"), col=1:2,pch=20)\n```\n\n::: {.cell-output-display}\n![](alphabeta_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\ndm1 <- vegdist(dat, method = \"jaccard\", binary = TRUE)\nadonis2(dm1 ~ classes  )  \n```\n\n::: {.cell-output .cell-output-stdout}\n```\nPermutation test for adonis under reduced model\nTerms added sequentially (first to last)\nPermutation: free\nNumber of permutations: 999\n\nadonis2(formula = dm1 ~ classes)\n         Df SumOfSqs      R2      F Pr(>F)\nclasses   1   0.2915 0.06188 1.1873  0.166\nResidual 18   4.4193 0.93812              \nTotal    19   4.7108 1.00000              \n```\n:::\n\n```{.r .cell-code}\nanosim(dm1, grouping = classes)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nanosim(x = dm1, grouping = classes) \nDissimilarity: binary jaccard \n\nANOSIM statistic R: 0.02167 \n      Significance: 0.36 \n\nPermutation: free\nNumber of permutations: 999\n```\n:::\n:::\n\n\nSo in this case we see a clear difference in alpha diversity between sites but it's not so clear for beta diversity.  It looks like the environment B samples are slightly more clustered while the A samples are more spread out.  The difference is not reflected in a PERMANOVA (via adonis2) or ANOSIM.\n\nThis is a good reminder that important differences in community composition might not be immediately visible in beta diversity plots.  Maybe you all know that anyway but it was a good reminder for me.\n\n",
    "supporting": [
      "alphabeta_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}